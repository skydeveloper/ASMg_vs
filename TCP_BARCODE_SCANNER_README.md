# TCP Баркод Скенер - Инструкции за Използване

## Преглед

Системата е модифицирана да използва TCP връзка вместо RS232 за комуникация с баркод скенера. Това позволява по-голяма гъвкавост и възможност за отдалечена работа.

## Промени в Конфигурацията

### Файл: `backend/config.py`

```python
# Barcode Scanner Configuration - TCP вместо RS232
BARCODE_SCANNER_HOST = '192.168.1.100'  # IP адрес на баркод скенера
BARCODE_SCANNER_PORT = 9100  # TCP порт на баркод скенера (стандартен за много скенери)

# Стари RS232 настройки (запасени за обратна съвместимост)
BARCODE_SCANNER_COM_PORT = 'COM3'  # Уверете се, че това е правилният порт
BARCODE_SCANNER_BAUDRATE = 9600
```

### Настройки за различни баркод скенери:

1. **Honeywell/Intermec скенери**: Порт 9100
2. **Zebra скенери**: Порт 9100
3. **Datalogic скенери**: Порт 9100 или 9101
4. **Cognex скенери**: Порт 9100
5. **Custom скенери**: Проверете документацията на производителя

## Нов TCP Баркод Мениджър

### Файл: `backend/services/tcp_barcode_manager.py`

Новият мениджър предоставя същия интерфейс като стария COM порт мениджър, но използва TCP връзка:

- `open_port()` - Отваря TCP връзка към баркод скенера
- `start_reading_task()` - Стартира фоновата задача за четене
- `close_port()` - Затваря TCP връзката
- `send_data()` - Изпраща данни към скенера (ако е необходимо)

## Тестване на Функционалността

### 1. Тестов скрипт за TCP мениджъра

```bash
python test_tcp_barcode.py
```

Този скрипт тества основната функционалност на TCP мениджъра.

### 2. TCP симулатор на баркод скенер

```bash
python tcp_barcode_simulator.py
```

Този скрипт създава симулатор на баркод скенер, който:
- Слуша на порт 9100
- Изпраща случайни баркодове на всеки 5-10 секунди
- Симулира реално поведение на баркод скенер

## Инструкции за Настройка

### Стъпка 1: Конфигуриране на баркод скенера

1. Уверете се, че баркод скенерът е свързан към мрежата
2. Намерете IP адреса на скенера (често чрез уеб интерфейс или конфигурационен софтуер)
3. Проверете TCP порта (обикновено 9100)

### Стъпка 2: Актуализиране на конфигурацията

Редактирайте `backend/config.py`:

```python
BARCODE_SCANNER_HOST = '192.168.1.100'  # Заменете с реалния IP адрес
BARCODE_SCANNER_PORT = 9100             # Заменете с реалния порт
```

### Стъпка 3: Тестване на връзката

1. Стартирайте TCP симулатора:
   ```bash
   python tcp_barcode_simulator.py
   ```

2. В отделен терминал, стартирайте основното приложение:
   ```bash
   python run.py
   ```

3. Проверете логовете за съобщения за успешно свързване

## Предимства на TCP пред RS232

1. **Отдалечена работа**: Можете да работите с баркод скенера от разстояние
2. **Мрежова интеграция**: По-лесна интеграция в съществуващи мрежи
3. **Множествени връзки**: Възможност за множество клиенти
4. **По-добра диагностика**: По-лесно откриване на проблеми с връзката
5. **Гъвкавост**: По-лесно преместване и конфигуриране

## Отстраняване на Проблеми

### Проблем: Timeout при свързване

**Причина**: Баркод скенерът не е достъпен на посочения IP адрес/порт

**Решение**:
1. Проверете IP адреса на скенера
2. Проверете дали скенерът е включен и свързан към мрежата
3. Тествайте връзката с `ping` или `telnet`

### Проблем: Connection refused

**Причина**: Портът не е отворен или скенерът не слуша на него

**Решение**:
1. Проверете конфигурацията на скенера
2. Уверете се, че TCP сървърът на скенера е стартиран
3. Проверете firewall настройките

### Проблем: Connection reset

**Причина**: Скенерът е прекъснал връзката

**Решение**:
1. Проверете захранването на скенера
2. Проверете мрежовата връзка
3. Рестартирайте скенера

## Лог съобщения

Системата генерира следните лог съобщения за TCP връзката:

- `log.tcpConnectionOpened` - Успешно отваряне на връзка
- `log.tcpConnectionOpenError` - Грешка при отваряне на връзка
- `log.tcpConnectionClosed` - Затваряне на връзка
- `log.tcpConnectionTimeout` - Timeout при свързване
- `log.tcpConnectionRefused` - Отказана връзка
- `log.tcpConnectionReset` - Прекъсната връзка

## Обратна Съвместимост

Старите RS232 настройки са запазени в конфигурацията за обратна съвместимост. Ако искате да се върнете към RS232, просто променете импорта в `backend/app.py` обратно към `ComPortManager`.

## Заключение

Новият TCP баркод мениджър предоставя по-голяма гъвкавост и възможности за интеграция, като запазва същия интерфейс и функционалност като оригиналния RS232 мениджър. 